name: deno-veify

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  format:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: setup deno
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x

      - name: auto-format code
        run: deno fmt
        
      - name: check for file changes
        id: git_status
        run: |
          echo "::set-output name=status::$(git status -s)"

      - name: create pull request with formatting corrections
        if: ${{contains(steps.git_status.outputs.status, ' ')}}
        uses: peter-evans/create-pull-request@v4
        with:
          branch: "${{ github.base_ref }}/auto-formatting"
          title: "${{ github.base_ref }}/auto-formatting"
          body: "Automated PR contains format corrections generated by a Github action for `${{ github.base_ref }}`"
          base: ${{ github.base_ref }}
          head: ${{ github.head_ref }}
          signoff: false
