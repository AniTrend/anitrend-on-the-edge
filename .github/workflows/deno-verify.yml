name: deno-veify

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  format:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Deno
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x

      - name: Check formatting
        run: deno fmt --check

      - name: Auto-format code
        id: fmt
        run: |
          if ! deno fmt --check --unstable; then
            echo "::set-output name=changes::true"
            deno fmt --unstable
          fi

      - name: Create pull request with formatting fixes
        if: steps.fmt.outputs.changes == 'true'
        uses: peter-evans/create-pull-request@v3
        with:
          branch: "${{ github.base_ref }}/auto-formatting"
          title: "${{ github.base_ref }}/auto-formatting"
          body: "Automated PR contains formatting fixes generated by a Github action for `${{ github.base_ref }}`"
          base: ${{ github.base_ref }}
          head: ${{ github.head_ref }}
          signoff: true
